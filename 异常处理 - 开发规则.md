

##  异常处理-develop-usage-rules

@(开发规则)


## 原则

1. Service层校验输入参数，明确定义每一个错误检查。尽量不抽取公共代码。
2. 尽量使用明确的错误类型，错误码，详细的错误描述。
3. Service层要明确捕获下层返回的错误，处理该异常。比如：跳过下面的逻辑，重新包装错误（InnerException），重试等等。
4. 能够记录日志的地方尽可能详细的记录日志。

## 错误码定义

参考平台的错误码定义规则。[详情][error_code]

保证一下原则：

1. 不含业务逻辑的错误考虑放入公共部分或者平台部分
2. 具体业务逻辑的错误放入对应的应用区段。比如：营销系统加入`0x1021`区段。

程序中错误码定义在Share项目的BMStateCode类型中，声明一个常量字符串即可。比如：

```
/// <summary>
/// 参数不符
/// </summary>
public const int CODE_ARGUMENT_INVALID = 0x1000000D;
```

## 错误描述

### 前台提示

错误提示语是是直接面对最终用户的，不能包含过多的专业术语。
常用：

1. 当前系统发生未知错误，请稍后重试。
2. [控件Label]输入的值超出范围限制，应该保证在0-50之间。 

### 异常描述

1. 参数不能为空（NULL，String.Empty）

   * [参数名称]不能为Null
   * [参数名称]不能为空字符串

2. 字符串长度超长

   * [参数名称]的输入超出长度限制，应该[限制描述]

   比如：在50个字符之内

3. 数字超出范围。

   * [参数名称]的输入值超出范围限制。应该[限制描述]

   比如：大于0、在0-50之间

4. 日期超出范围。

   * [参数名称]的输入值超出范围限制。应该[限制描述]

   比如：早于计划完工时间、在1970-01-01之后

5. 不符合格式。比如约定格式或者常用格式（邮箱地址、电话号码）

   * [参数名称]的输入格式不正确。应该[限制描述]

   比如：

   * 是：yyyy-MM-dd、是由多个ID构成，用逗号分隔
   * 符合标准的邮箱地址格式，比如：name@shanghai3h.com


[error_code]: http://128.1.10.2:8080/wapwiki/#!doc/open_api/api_common.md#错误码

